function e(e=document.body,t,d=null){if("admin"!==JSON.parse(localStorage.getItem("user")||"{}").role)return void l("âŒ Solo los administradores pueden publicar contenido","error");const s=document.getElementById("publishModal");s&&s.remove();const c=!!d,u=document.createElement("div");u.id="publishModal",u.className="modal",u.innerHTML=`\n    <div class="modal-content">\n      <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">\n        \n        <button id="closePublishModal" class="btn-cancelar" style="padding: 8px 16px;">âœ• Cerrar</button>\n      </header>\n      \n      <form id="publishForm" style="display: grid; gap: 20px;">\n        <div>\n          <label for="pub-title">ğŸ“ TÃ­tulo *</label>\n          <input type="text" id="pub-title" value="${a((null==d?void 0:d.title)||"")}" required \n                 placeholder="TÃ­tulo llamativo para tu publicaciÃ³n..." />\n        </div>\n        \n        <div>\n          <label for="pub-desc">ğŸ“„ DescripciÃ³n *</label>\n          <textarea id="pub-desc" rows="4" required \n                    placeholder="Describe el contenido de tu publicaciÃ³n...">${a((null==d?void 0:d.description)||"")}</textarea>\n        </div>\n        \n        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">\n          <div>\n            <label for="pub-category">ğŸ“‚ CategorÃ­a *</label>\n            <select id="pub-category" required>\n              <option value="">Selecciona una categorÃ­a...</option>\n              <option value="noticias" ${"noticias"===(null==d?void 0:d.category)?"selected":""}>ğŸ“° Noticias</option>\n              <option value="proyectos" ${"proyectos"===(null==d?void 0:d.category)?"selected":""}>ğŸš€ Proyectos</option>\n            </select>\n          </div>\n          \n          <div>\n            <label for="pub-media-type">ğŸ¬ Tipo de contenido</label>\n            <select id="pub-media-type">\n              <option value="image" ${"image"===(null==d?void 0:d.type)?"selected":""}>ğŸ–¼ï¸ Imagen</option>\n              <option value="video" ${"video"===(null==d?void 0:d.type)?"selected":""}>ğŸ¬ Video</option>\n            </select>\n          </div>\n        </div>\n        \n        <div style="background: rgba(37,99,235,0.1); padding: 20px; border-radius: var(--radius); border: 1px solid var(--border);">\n          <h4 style="margin-top: 0; color: var(--text);">ğŸ”— Contenido Multimedia</h4>\n          <p style="color: var(--muted); font-size: 14px; margin-bottom: 16px;">\n            <strong>Recomendado:</strong> Usa enlaces externos (YouTube, Google Drive, etc.) para ahorrar espacio.\n          </p>\n          \n          <div style="display: grid; gap: 16px;">\n            <div>\n              <label for="pub-external-url">ğŸŒ Enlace externo (YouTube, Drive, Facebook, etc.)</label>\n              <input type="url" id="pub-external-url" value="${a((null==d?void 0:d.image)||"")}"\n                     placeholder="https://youtube.com/watch?v=... o https://drive.google.com/..." />\n              <div style="font-size: 14px; color: var(--muted); margin-top: 4px;">\n                âœ… YouTube â€¢ âœ… Google Drive â€¢ âœ… Facebook â€¢ âœ… Cualquier URL de imagen/video\n              </div>\n            </div>\n            \n            <div style="text-align: center; color: var(--muted); padding: 8px;">\n              <strong>-- O --</strong>\n            </div>\n            \n            <div>\n              <label for="pub-local-file">ğŸ“ Subir archivo local (opcional)</label>\n              <input type="file" id="pub-local-file" accept="image/*,video/*" />\n              <div style="font-size: 14px; color: var(--muted); margin-top: 4px;">\n                Solo si no tienes enlace externo. MÃ¡ximo 5MB.\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        ${(null==d?void 0:d.image)?`\n          <div style="background: rgba(255,255,255,0.03); padding: 16px; border-radius: var(--radius); border: 1px solid var(--border);">\n            <h4 style="margin-top: 0; color: var(--text);">ğŸ‘ï¸ Vista previa actual</h4>\n            <div style="text-align: center;">\n              ${r(d)}\n            </div>\n          </div>\n        `:""}\n        \n        <div style="display: flex; gap: 16px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid var(--border);">\n          <button type="button" id="cancelPublish" class="btn-cancelar">\n            âŒ Cancelar\n          </button>\n          <button type="submit" id="submitPublish" class="btn-publicar">\n            ${c?"ğŸ’¾ Guardar cambios":"ğŸš€ Publicar"}\n          </button>\n        </div>\n      </form>\n    </div>\n  `,e.appendChild(u),u.querySelector("#closePublishModal").onclick=()=>u.remove(),u.querySelector("#cancelPublish").onclick=()=>u.remove(),u.addEventListener("click",e=>{e.target===u&&u.remove()}),u.querySelector("#publishForm").addEventListener("submit",async e=>{e.preventDefault(),await async function(e,t,o){const r=e.querySelector("#submitPublish"),d=r.textContent;r.innerHTML='<span class="spinner"></span> Procesando...',r.disabled=!0;try{const r=e.querySelector("#pub-title").value.trim(),l=e.querySelector("#pub-desc").value.trim(),d=e.querySelector("#pub-category").value,p=e.querySelector("#pub-media-type").value,m=e.querySelector("#pub-external-url").value.trim(),v=e.querySelector("#pub-local-file").files[0];if(!r||!l||!d)throw new Error("Por favor completa todos los campos obligatorios");let g="",b=p;if(m)g=n(m),b=i(m)||p;else if(v){if(v.type.startsWith("image/"))g=await(s=v,c=800,u=.4,new Promise((e,t)=>{const n=new FileReader;n.readAsDataURL(s),n.onload=n=>{const i=new Image;i.src=n.target.result,i.onload=()=>{const t=document.createElement("canvas");let n=i.width,o=i.height;n>c&&(o*=c/n,n=c),t.width=n,t.height=o,t.getContext("2d").drawImage(i,0,0,n,o),e(t.toDataURL("image/jpeg",u))},i.onerror=t},n.onerror=t}));else{if(v.size>10485760)throw new Error("El archivo de video es muy grande. MÃ¡ximo 10MB");g=await function(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>n(new Error("Error reading file")),i.readAsDataURL(e)})}(v)}b=v.type.startsWith("video/")?"video":"image"}else o?(g=o.image,b=o.type):(g=function(e){const t=`\n    <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">\n      <rect width="400" height="300" fill="#233240"/>\n      <text x="200" y="140" font-family="Arial, sans-serif" font-size="16" fill="#ffffff" text-anchor="middle" dominant-baseline="middle">\n        ${a(e.slice(0,30))}${e.length>30?"...":""}\n      </text>\n      <text x="200" y="170" font-family="Arial, sans-serif" font-size="12" fill="#8fa3c4" text-anchor="middle" dominant-baseline="middle">\n        ğŸ“„ Sin imagen\n      </text>\n    </svg>\n  `;return`data:image/svg+xml;base64,${btoa(t)}`}(r),b="image");const y={id:o?o.id:Date.now(),title:r,description:l,category:d,image:g,type:b,likes:o?o.likes:0,comments:o?o.comments:[],createdAt:o?o.createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};"function"==typeof t&&await t(y),e.remove()}catch(p){l(`âŒ Error: ${p.message}`,"error"),r.textContent=d,r.disabled=!1}var s,c,u}(u,t,d)});const p=u.querySelector("#pub-external-url"),m=u.querySelector("#pub-media-type");p.addEventListener("input",function(e,t){let n;return function(...i){const o=()=>{clearTimeout(n),e(...i)};clearTimeout(n),n=setTimeout(o,t)}}(()=>{o(u,p.value,m.value)},500)),m.addEventListener("change",()=>{o(u,p.value,m.value)})}function t(t,n,i){e(t,i,n)}function n(e){if(e.includes("youtube.com")||e.includes("youtu.be")){const t=function(e){const t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,n=e.match(t);return n&&11===n[7].length?n[7]:null}(e);if(t)return`https://www.youtube.com/embed/${t}`}if(e.includes("drive.google.com")){const t=e.match(/\/d\/([a-zA-Z0-9-_]+)/);if(t)return`https://drive.google.com/file/d/${t[1]}/view`}return e}function i(e){if(e.includes("youtube.com")||e.includes("youtu.be"))return"video";const t=e.toLowerCase();return[".jpg",".jpeg",".png",".gif",".webp"].some(e=>t.includes(e))?"image":[".mp4",".webm",".ogg",".mov"].some(e=>t.includes(e))?"video":null}function o(e,t,o){const a=e.querySelector("#livePreview");if(a&&a.remove(),!t)return;const l=document.createElement("div");l.id="livePreview",l.style.cssText="\n    background: rgba(255,255,255,0.03);\n    padding: 16px;\n    border-radius: var(--radius);\n    border: 1px solid var(--border);\n    margin-top: 16px;\n  ",l.innerHTML=`\n    <h4 style="margin-top: 0; color: var(--text);">ğŸ‘ï¸ Vista previa en vivo</h4>\n    <div style="text-align: center;">\n      ${r({image:n(t),type:i(t)||o,title:"Vista previa"})}\n    </div>\n  `;e.querySelector("#publishForm").appendChild(l)}function r(e){return e.image?"video"===e.type?e.image.includes("youtube.com")||e.image.includes("embed/")?`\n        <iframe src="${e.image}" \n                width="100%" \n                height="200" \n                frameborder="0" \n                allowfullscreen \n                style="border-radius: 8px;">\n        </iframe>\n      `:`\n      <video controls style="width: 100%; max-height: 200px; border-radius: 8px;">\n        <source src="${e.image}" />\n        Tu navegador no soporta video HTML5.\n      </video>\n    `:`<img src="${e.image}" alt="${a(e.title||"Preview")}" style="max-width: 100%; max-height: 200px; border-radius: 8px;" />`:'<div style="color: var(--muted); padding: 20px;">ğŸ“„ Sin contenido multimedia</div>'}function a(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function l(e,t="success"){const n=document.createElement("div");n.className="toast-message",n.textContent=e,"error"===t&&(n.style.background="linear-gradient(135deg, var(--danger), #b91c1c)"),document.body.appendChild(n),setTimeout(()=>{n.parentNode&&(n.style.animation="slideInRight 0.3s ease-out reverse",setTimeout(()=>n.remove(),300))},3e3)}export{t as renderEditPost,e as renderPublish};
